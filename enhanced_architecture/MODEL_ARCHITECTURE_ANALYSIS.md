# ğŸ—ï¸ å¢å¼ºå‹æŠ—èŒè‚½ç”Ÿæˆæ¨¡å‹æ¶æ„åˆ†æ

## ğŸ“‹ æ•´ä½“è®¾è®¡æ¦‚è¿°

æ‚¨çš„é¡¹ç›®å®é™…ä¸ŠåŒ…å«äº†**ä¸¤ä¸ªç‹¬ç«‹ä½†äº’è¡¥çš„æ¨¡å‹ç³»ç»Ÿ**ï¼š

### 1. ğŸ¯ åˆ†ç±»æ¨¡å‹ç³»ç»Ÿ (Gram-é˜´æ€§èŒåˆ†ç±»å™¨)
- **ä½ç½®**: [`gram_predictor/`](../gram_predictor/) å’Œ [`hybrid_classifier.py`](../hybrid_classifier.py)
- **åŠŸèƒ½**: é¢„æµ‹ç»™å®šåºåˆ—æ˜¯å¦å¯¹é©å…°æ°é˜´æ€§èŒæœ‰æ•ˆ
- **æ¶æ„**: LSTM + MLPæ··åˆæ¨¡å‹
- **çŠ¶æ€**: âœ… å·²å®Œæˆè®­ç»ƒï¼Œå¯ç›´æ¥ä½¿ç”¨

### 2. ğŸ§¬ ç”Ÿæˆæ¨¡å‹ç³»ç»Ÿ (åºåˆ—ç”Ÿæˆå™¨)
- **ä½ç½®**: [`enhanced_architecture/`](./enhanced_architecture/)
- **åŠŸèƒ½**: ç”Ÿæˆæ–°çš„æŠ—é©å…°æ°é˜´æ€§èŒè‚½åºåˆ—
- **æ¶æ„**: D3PMæ‰©æ•£æ¨¡å‹ + ESM-2è¾…åŠ©ç¼–ç å™¨
- **çŠ¶æ€**: ğŸš€ æ­£åœ¨è®­ç»ƒä¸­

---

## ğŸ”¬ ç”Ÿæˆæ¨¡å‹è¯¦ç»†æ¶æ„åˆ†æ

### æ ¸å¿ƒè®¾è®¡ç†å¿µ
æ‚¨çš„ç”Ÿæˆæ¨¡å‹é‡‡ç”¨äº†**åŒè·¯å¾„æ¶æ„**ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å…ˆè¿›çš„è®¾è®¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŒè·¯å¾„ç”Ÿæˆæ¶æ„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¸»è·¯å¾„: D3PMç¦»æ•£æ‰©æ•£æ¨¡å‹                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ éšæœºå™ªå£°åºåˆ—     â”‚â†’â”‚ UNetå»å™ªç½‘ç»œ  â”‚â†’â”‚ æ¸…æ´æ°¨åŸºé…¸åºåˆ—   â”‚  â”‚
â”‚ â”‚ (æ°¨åŸºé…¸tokens)  â”‚  â”‚ (Transformer) â”‚  â”‚ (æŠ—èŒè‚½)        â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†‘                              â”‚
â”‚ è¾…åŠ©è·¯å¾„: ESM-2ç‰¹å¾å¼•å¯¼                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ æ­£è´Ÿæ ·æœ¬åºåˆ—     â”‚â†’â”‚ ESM-2ç¼–ç å™¨   â”‚â†’â”‚ å…¨å±€ç‰¹å¾å‘é‡     â”‚  â”‚
â”‚ â”‚ (å¯¹æ¯”å­¦ä¹ )      â”‚  â”‚ (é¢„è®­ç»ƒ)      â”‚  â”‚ (æ¡ä»¶ä¿¡æ¯)      â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ¯ è®¾è®¡ä¼˜åŠ¿è¯„ä»·

#### âœ… ä¼˜ç§€çš„è®¾è®¡é€‰æ‹©ï¼š

1. **D3PMç¦»æ•£æ‰©æ•£æ¨¡å‹**
   - **ä¼˜åŠ¿**: ä¸“é—¨ä¸ºç¦»æ•£tokenè®¾è®¡ï¼Œæ¯”VAEæ›´é€‚åˆè›‹ç™½è´¨åºåˆ—
   - **åˆ›æ–°æ€§**: åœ¨è›‹ç™½è´¨ç”Ÿæˆé¢†åŸŸç›¸å¯¹æ–°é¢–
   - **è´¨é‡**: ç†è®ºä¸Šèƒ½ç”Ÿæˆæ›´é«˜è´¨é‡ã€æ›´å¤šæ ·åŒ–çš„åºåˆ—

2. **ESM-2é¢„è®­ç»ƒç¼–ç å™¨**
   - **ä¼˜åŠ¿**: åˆ©ç”¨Metaçš„å¤§è§„æ¨¡è›‹ç™½è´¨é¢„è®­ç»ƒæ¨¡å‹
   - **ç‰¹å¾è´¨é‡**: æ¯”ä»å¤´è®­ç»ƒçš„ç¼–ç å™¨è´¨é‡é«˜å¾—å¤š
   - **ç”Ÿç‰©å­¦æ„ä¹‰**: ç¼–ç äº†ä¸°å¯Œçš„è›‹ç™½è´¨ç»“æ„å’ŒåŠŸèƒ½ä¿¡æ¯

3. **å¯¹æ¯”å­¦ä¹ æœºåˆ¶**
   - **ç›®æ ‡å¯¼å‘**: æ˜ç¡®åŒºåˆ†é˜³æ€§èŒvsé˜´æ€§èŒç‰¹å¼‚æ€§
   - **ç‰¹å¾å¢å¼º**: é€šè¿‡å¯¹æ¯”å­¦ä¹ æå‡ç‰¹å¾è¡¨ç¤ºè´¨é‡
   - **æ¡ä»¶ç”Ÿæˆ**: ä¸ºæ‰©æ•£æ¨¡å‹æä¾›æœ‰æ„ä¹‰çš„æ¡ä»¶ä¿¡æ¯

4. **å¤šç§é‡‡æ ·ç­–ç•¥**
   - **æ ‡å‡†é‡‡æ ·**: åŸºç¡€çš„éšæœºé‡‡æ ·
   - **Top-ké‡‡æ ·**: æ§åˆ¶ç”Ÿæˆçš„ç¡®å®šæ€§
   - **Nucleusé‡‡æ ·**: å¹³è¡¡è´¨é‡å’Œå¤šæ ·æ€§
   - **å¤šæ ·æ€§é‡‡æ ·**: é˜²æ­¢è¿‡åº¦ç”ŸæˆæŸäº›æ°¨åŸºé…¸

#### ğŸ”§ å¯ä»¥æ”¹è¿›çš„æ–¹é¢ï¼š

1. **æ¡ä»¶æ³¨å…¥æœºåˆ¶**
   - **å½“å‰**: ESM-2ç‰¹å¾ç®€å•åŠ åˆ°åºåˆ—ç‰¹å¾ä¸Š
   - **æ”¹è¿›**: å¯ä»¥ä½¿ç”¨æ›´å¤æ‚çš„æ³¨æ„åŠ›æœºåˆ¶æˆ–äº¤å‰æ³¨æ„åŠ›

2. **åºåˆ—é•¿åº¦æ§åˆ¶**
   - **å½“å‰**: å›ºå®šé•¿åº¦ç”Ÿæˆ
   - **æ”¹è¿›**: å¯ä»¥æ·»åŠ åŠ¨æ€é•¿åº¦æ§åˆ¶æœºåˆ¶

---

## ğŸš€ è®­ç»ƒå®Œæˆåçš„åºåˆ—ç”Ÿæˆæµç¨‹

### 1. åŸºç¡€ç”Ÿæˆ
```python
# åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹
from train_dual_4090 import Dual4090Trainer
from diffusion_models.d3pm_diffusion import D3PMDiffusion

# åˆå§‹åŒ–è®­ç»ƒå™¨å¹¶åŠ è½½æ£€æŸ¥ç‚¹
trainer = Dual4090Trainer("dual_4090")
trainer.initialize_models()
trainer.load_checkpoint("output/checkpoints/best.pt")

# ç”Ÿæˆåºåˆ—
generated_tokens = trainer.diffusion_model.sample(
    batch_size=10,           # ç”Ÿæˆ10æ¡åºåˆ—
    seq_len=50,             # æ¯æ¡åºåˆ—50ä¸ªæ°¨åŸºé…¸
    temperature=1.0         # æ§åˆ¶éšæœºæ€§
)

# è½¬æ¢ä¸ºæ°¨åŸºé…¸åºåˆ—
from data_loader import tokens_to_sequence
sequences = []
for tokens in generated_tokens:
    seq = tokens_to_sequence(tokens.cpu().numpy())
    sequences.append(seq)
    print(f"Generated: {seq}")
```

### 2. æ¡ä»¶ç”Ÿæˆï¼ˆä½¿ç”¨ESM-2ç‰¹å¾ï¼‰
```python
# æå–å‚è€ƒåºåˆ—çš„ESM-2ç‰¹å¾
reference_sequences = [
    "GLFDIVKKVVGALGSLGLVVR",  # å·²çŸ¥çš„æŠ—é˜´æ€§èŒè‚½
    "KWVKAMDGVIDMLFYKMVYK"
]

# è·å–ESM-2ç‰¹å¾
esm2_model = trainer.esm2_encoder.module if hasattr(trainer.esm2_encoder, 'module') else trainer.esm2_encoder
esm_features = esm2_model.encode_sequences(reference_sequences)

# åŸºäºç‰¹å¾ç”Ÿæˆç›¸ä¼¼åºåˆ—
generated_tokens = trainer.diffusion_model.sample(
    batch_size=10,
    seq_len=50,
    esm_features=esm_features.mean(dim=0, keepdim=True),  # ä½¿ç”¨å¹³å‡ç‰¹å¾
    temperature=0.8  # ç¨å¾®é™ä½éšæœºæ€§
)
```

### 3. é«˜è´¨é‡ç”Ÿæˆï¼ˆå¤šç§é‡‡æ ·ç­–ç•¥ï¼‰
```python
# Top-ké‡‡æ ·ï¼šæ›´ç¡®å®šæ€§çš„ç”Ÿæˆ
generated_topk = trainer.diffusion_model.top_k_sample(
    batch_size=5,
    seq_len=40,
    k=10,              # åªä»æ¦‚ç‡æœ€é«˜çš„10ä¸ªæ°¨åŸºé…¸ä¸­é€‰æ‹©
    temperature=0.7
)

# Nucleusé‡‡æ ·ï¼šå¹³è¡¡è´¨é‡å’Œå¤šæ ·æ€§
generated_nucleus = trainer.diffusion_model.nucleus_sample(
    batch_size=5,
    seq_len=40,
    p=0.9,             # ç´¯ç§¯æ¦‚ç‡é˜ˆå€¼
    temperature=0.8
)

# å¤šæ ·æ€§é‡‡æ ·ï¼šç¡®ä¿æ°¨åŸºé…¸åˆ†å¸ƒåˆç†
generated_diverse = trainer.diffusion_model.diverse_sample(
    batch_size=5,
    seq_len=40,
    diversity_strength=0.3,  # å¤šæ ·æ€§å¼ºåº¦
    temperature=1.0
)
```

### 4. æ‰¹é‡ç”Ÿæˆå’Œç­›é€‰
```python
def generate_and_filter_sequences(num_sequences=100, min_length=20, max_length=60):
    """ç”Ÿæˆå¹¶ç­›é€‰é«˜è´¨é‡åºåˆ—"""
    all_sequences = []
    
    # åˆ†æ‰¹ç”Ÿæˆ
    batch_size = 20
    for i in range(0, num_sequences, batch_size):
        current_batch = min(batch_size, num_sequences - i)
        
        # ä½¿ç”¨ä¸åŒçš„é‡‡æ ·ç­–ç•¥
        if i % 3 == 0:
            tokens = trainer.diffusion_model.sample(current_batch, max_length)
        elif i % 3 == 1:
            tokens = trainer.diffusion_model.top_k_sample(current_batch, max_length, k=15)
        else:
            tokens = trainer.diffusion_model.diverse_sample(current_batch, max_length)
        
        # è½¬æ¢ä¸ºåºåˆ—
        for token_seq in tokens:
            seq = tokens_to_sequence(token_seq.cpu().numpy())
            if min_length <= len(seq) <= max_length:
                all_sequences.append(seq)
    
    return all_sequences

# ç”Ÿæˆå€™é€‰åºåˆ—
candidates = generate_and_filter_sequences(200)
print(f"Generated {len(candidates)} candidate sequences")
```

---

## ğŸ¯ ä¸åˆ†ç±»æ¨¡å‹çš„æ•´åˆä½¿ç”¨

### å®Œæ•´çš„å‘ç°æµç¨‹
```python
def discover_novel_amp_sequences():
    """å®Œæ•´çš„æ–°å‹æŠ—èŒè‚½å‘ç°æµç¨‹"""
    
    # 1. ç”Ÿæˆå€™é€‰åºåˆ—
    candidates = generate_and_filter_sequences(500)
    
    # 2. ä½¿ç”¨åˆ†ç±»æ¨¡å‹ç­›é€‰
    from gram_predictor.utils.predictor import predict_sequences
    
    # é¢„æµ‹æŠ—èŒæ´»æ€§
    predictions = predict_sequences(candidates)
    
    # ç­›é€‰é«˜æ´»æ€§åºåˆ—
    high_activity_seqs = [
        seq for seq, pred in zip(candidates, predictions)
        if pred['probability'] > 0.8  # é«˜ç½®ä¿¡åº¦
    ]
    
    # 3. è¿›ä¸€æ­¥åˆ†æ
    print(f"Generated {len(candidates)} candidates")
    print(f"High-activity sequences: {len(high_activity_seqs)}")
    
    # 4. ä¿å­˜ç»“æœ
    with open("discovered_sequences.txt", "w") as f:
        for seq in high_activity_seqs:
            f.write(f"{seq}\n")
    
    return high_activity_seqs
```

---

## ğŸ“Š æ¨¡å‹æ€§èƒ½è¯„ä¼°

### ç”Ÿæˆè´¨é‡æŒ‡æ ‡
1. **åºåˆ—æœ‰æ•ˆæ€§**: ç”Ÿæˆçš„åºåˆ—æ˜¯å¦ç¬¦åˆæ°¨åŸºé…¸è§„åˆ™
2. **å¤šæ ·æ€§**: ç”Ÿæˆåºåˆ—ä¹‹é—´çš„å·®å¼‚ç¨‹åº¦
3. **æ–°é¢–æ€§**: ä¸è®­ç»ƒæ•°æ®çš„ç›¸ä¼¼åº¦
4. **æ´»æ€§é¢„æµ‹**: ä½¿ç”¨åˆ†ç±»æ¨¡å‹è¯„ä¼°æŠ—èŒæ´»æ€§
5. **ç‰©ç†åŒ–å­¦æ€§è´¨**: åˆ†æç–æ°´æ€§ã€ç”µè·ç­‰ç‰¹æ€§

### é¢„æœŸæ€§èƒ½
- **åºåˆ—æœ‰æ•ˆæ€§**: >95%
- **æŠ—èŒæ´»æ€§é¢„æµ‹**: >70%
- **æ–°é¢–æ€§**: ä¸è®­ç»ƒæ•°æ®ç›¸ä¼¼åº¦<80%
- **å¤šæ ·æ€§**: åºåˆ—é—´å¹³å‡ç¼–è¾‘è·ç¦»>10

---

## ğŸ”® æ€»ç»“ä¸å±•æœ›

### æ‚¨çš„æ¨¡å‹è®¾è®¡è¯„ä»·ï¼šâ­â­â­â­â­

1. **æŠ€æœ¯å…ˆè¿›æ€§**: ä½¿ç”¨äº†æœ€æ–°çš„æ‰©æ•£æ¨¡å‹å’Œé¢„è®­ç»ƒè›‹ç™½è´¨æ¨¡å‹
2. **æ¶æ„åˆç†æ€§**: åŒè·¯å¾„è®¾è®¡å……åˆ†åˆ©ç”¨äº†ä¸åŒæ¨¡å‹çš„ä¼˜åŠ¿
3. **ç›®æ ‡æ˜ç¡®æ€§**: ä¸“é—¨é’ˆå¯¹é©å…°æ°é˜´æ€§èŒçš„ç‰¹å¼‚æ€§è®¾è®¡
4. **å®ç”¨æ€§**: ç»“åˆåˆ†ç±»å’Œç”Ÿæˆï¼Œå½¢æˆå®Œæ•´çš„å‘ç°æµç¨‹

### åº”ç”¨å‰æ™¯
- **è¯ç‰©å‘ç°**: å¿«é€Ÿç”Ÿæˆå€™é€‰æŠ—èŒè‚½
- **ä¸ªæ€§åŒ–æ²»ç–—**: é’ˆå¯¹ç‰¹å®šç—…åŸèŒçš„å®šåˆ¶åŒ–è‚½æ®µ
- **ç ”ç©¶å·¥å…·**: æ¢ç´¢åºåˆ—-åŠŸèƒ½å…³ç³»

è¿™æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„è®¾è®¡ï¼Œåœ¨æŠ—èŒè‚½ç”Ÿæˆé¢†åŸŸå…·æœ‰å¾ˆå¼ºçš„åˆ›æ–°æ€§å’Œå®ç”¨ä»·å€¼ï¼