# ESM-2模型对比与推荐

## 🔍 可用的ESM-2模型规格

| 模型名称 | 参数量 | 特征维度 | 层数 | 注意力头 | 显存需求 | 推理速度 | 性能 |
|---------|--------|----------|------|----------|----------|----------|------|
| `esm2_t6_8M_UR50D` | 8M | 320 | 6 | 20 | ~1GB | 最快 | 基础 |
| `esm2_t12_35M_UR50D` | 35M | 480 | 12 | 20 | ~2GB | 快 | 良好 |
| `esm2_t30_150M_UR50D` | 150M | 640 | 30 | 20 | ~4GB | 中等 | 优秀 |
| `esm2_t33_650M_UR50D` | 650M | 1280 | 33 | 20 | ~8GB | 慢 | 极佳 |
| `esm2_t36_3B_UR50D` | 3B | 2560 | 36 | 40 | ~12GB | 很慢 | 顶级 |

## 🎯 针对双4090配置的推荐

### 推荐配置：`dual_4090`
- **ESM-2模型**: `facebook/esm2_t30_150M_UR50D` (150M参数)
- **理由**:
  - 性能与效率的最佳平衡点
  - 单GPU显存占用约4GB，双卡可以轻松处理
  - 特征质量显著优于35M模型
  - 训练速度仍然可接受

### 备选方案

#### 1. 保守选择：`esm2_t12_35M_UR50D`
```python
# 在配置中修改
config.esm2.model_name = "facebook/esm2_t12_35M_UR50D"
config.esm2.feature_dim = 480
```
- **优点**: 训练速度快，显存占用少
- **缺点**: 特征表示能力有限

#### 2. 激进选择：`esm2_t33_650M_UR50D`
```python
# 在配置中修改
config.esm2.model_name = "facebook/esm2_t33_650M_UR50D"
config.esm2.feature_dim = 1280
config.data.batch_size = 16  # 需要减小批次大小
```
- **优点**: 最强的特征表示能力
- **缺点**: 训练速度较慢，需要更多显存

## 📊 性能预期

### 特征质量提升
- **8M → 35M**: +10-15% 特征质量提升
- **35M → 150M**: +15-20% 特征质量提升
- **150M → 650M**: +5-10% 特征质量提升（边际递减）

### 训练时间估算（双4090）
- **35M模型**: ~4-6小时（200 epochs）
- **150M模型**: ~6-10小时（200 epochs）
- **650M模型**: ~12-20小时（200 epochs）

## 🔧 配置使用方法

### 1. 使用推荐的双4090配置
```bash
cd enhanced_architecture
python start_training.py --config dual_4090
```

### 2. 自定义ESM-2模型
```python
# 在代码中动态修改
from config.model_config import get_config

config = get_config("dual_4090")
config.esm2.model_name = "facebook/esm2_t33_650M_UR50D"  # 使用650M模型
config.esm2.feature_dim = 1280
config.data.batch_size = 16  # 调整批次大小
```

## 💡 优化建议

### 1. 显存优化
- 启用混合精度训练：`use_mixed_precision = True`
- 使用梯度累积：减小批次大小，增加累积步数
- 启用ESM-2特征缓存：`cache_features = True`

### 2. 速度优化
- 冻结ESM-2参数：`freeze_esm = True`（推荐初期训练）
- 使用多进程数据加载：`num_workers = 8`
- 启用分布式训练：`use_distributed = True`

### 3. 渐进式训练策略
1. **阶段1**: 使用35M模型快速验证架构
2. **阶段2**: 升级到150M模型进行完整训练
3. **阶段3**: 如需要，使用650M模型进行精调

## 🚨 注意事项

1. **首次下载**: 大模型首次下载需要时间，建议提前下载
2. **显存监控**: 使用`nvidia-smi`监控显存使用情况
3. **检查点保存**: 大模型训练时间长，确保定期保存检查点
4. **温度调节**: 长时间训练注意GPU温度，必要时调整风扇策略

## 📈 预期性能提升

使用150M ESM-2模型相比8M模型的预期提升：
- **特征质量**: +25-30%
- **生成序列质量**: +15-20%
- **抗菌活性预测准确率**: +10-15%
- **整体模型性能**: 从70-80分提升至85-90分

---

**推荐**: 对于您的双4090配置，建议使用`dual_4090`配置，它已经优化为使用150M ESM-2模型，能够充分利用您的硬件资源。